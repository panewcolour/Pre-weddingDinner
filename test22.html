<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²­ì²©ì¥ í€˜ìŠ¤íŠ¸: ì „ì„¤ì˜ ì‹œì‘</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=DungGeunMo&display=swap" rel="stylesheet">
    <style>
        /* ë‘¥ê·¼ëª¨ í°íŠ¸ëŠ” í•œê¸€ í”½ì…€ í°íŠ¸ë¡œ ë ˆíŠ¸ë¡œ ëŠë‚Œì„ ì¤ë‹ˆë‹¤ */
        body {
            font-family: 'DungGeunMo', 'Press Start 2P', cursive;
            background-color: #202020;
            color: white;
            overflow: hidden; /* ê²Œì„ í™”ë©´ ëŠë‚Œ */
            user-select: none; /* ê¾¹ ëˆ„ë¥´ê¸° ì‹œ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
            -webkit-user-select: none;
        }

        .pixel-border {
            box-shadow: 
                -4px 0 0 0 white,
                4px 0 0 0 white,
                0 -4px 0 0 white,
                0 4px 0 0 white;
            margin: 4px;
        }

        .pixel-btn {
            background-color: #3b82f6;
            box-shadow: 
                -4px 0 0 0 #1d4ed8,
                4px 0 0 0 #1d4ed8,
                0 -4px 0 0 #1d4ed8,
                0 4px 0 0 #1d4ed8;
            transition: transform 0.1s;
        }
        
        .pixel-btn:active {
            transform: scale(0.95);
        }

        .pixel-btn-red {
            background-color: #ef4444;
            box-shadow: 
                -4px 0 0 0 #b91c1c,
                4px 0 0 0 #b91c1c,
                0 -4px 0 0 #b91c1c,
                0 4px 0 0 #b91c1c;
        }

        /* ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ìš© ì´ˆë¡ìƒ‰ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .pixel-btn-green {
            background-color: #10b981;
            box-shadow: 
                -4px 0 0 0 #059669,
                4px 0 0 0 #059669,
                0 -4px 0 0 #059669,
                0 4px 0 0 #059669;
        }

        /* ê¹œë¹¡ì´ëŠ” ì»¤ì„œ íš¨ê³¼ */
        .cursor::after {
            content: 'â–¼';
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .scanline {
            width: 100%;
            height: 100px;
            z-index: 10;
            background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(255, 255, 255, 0.1) 50%, rgba(0,0,0,0) 100%);
            opacity: 0.1;
            position: absolute;
            bottom: 100%;
            animation: scanline 10s linear infinite;
            pointer-events: none;
        }
        @keyframes scanline {
            0% { bottom: 100%; }
            100% { bottom: -100px; }
        }
        
        /* í”ë“¤ë¦¬ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* --- New Game Styles (Walking Game) --- */
        #game-canvas {
            position: relative;
            width: 100%;
            height: 100%;
            /* ë³€ê²½ëœ ë¶€ë¶„: ë…¸ì„ ê·¸ë¼ë°ì´ì…˜ (ë‚¨ìƒ‰ -> ë³´ë¼ -> ë¶„í™ -> ì£¼í™©) */
            background: linear-gradient(to bottom, #1e1b4b 0%, #4c1d95 30%, #be185d 60%, #f97316 85%, #fdba74 100%);
            overflow: hidden;
        }
        
        /* Pixel Background Elements */
        .bg-layer {
            position: absolute;
            width: 200%; /* Scrolling loop */
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        /* ë³„ ë°˜ì§ì„ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes twinkle {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.4; }
        }

        .stars {
            background-image: 
                /* ì‘ì€ ë³„ë“¤ */
                radial-gradient(1px 1px at 25px 5px, white, transparent),
                radial-gradient(1px 1px at 50px 25px, white, transparent),
                radial-gradient(1px 1px at 125px 20px, white, transparent),
                radial-gradient(1px 1px at 180px 10px, white, transparent),
                /* ì¤‘ê°„ ë³„ë“¤ */
                radial-gradient(1.5px 1.5px at 50px 75px, white, transparent),
                radial-gradient(1.5px 1.5px at 150px 40px, white, transparent),
                /* í° ë³„ë“¤ */
                radial-gradient(2px 2px at 15px 125px, white, transparent),
                radial-gradient(2.5px 2.5px at 110px 80px, white, transparent);
            background-size: 200px 200px;
            opacity: 0.8;
            animation: twinkle 4s infinite ease-in-out;
        }

        /* ë‹¬ (Moon) ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .moon {
            position: absolute;
            top: 10%;
            right: 15%;
            width: 50px;
            height: 50px;
            background: transparent;
            border-radius: 50%;
            /* ì´ˆìŠ¹ë‹¬ ëª¨ì–‘ ë§Œë“¤ê¸° */
            box-shadow: -10px 5px 0 0 #fde047; 
            filter: drop-shadow(0 0 10px #fde047); /* ë¹›ë‚˜ëŠ” íš¨ê³¼ */
            opacity: 0.9;
            z-index: 1;
        }

        .mountains {
            bottom: 40%;
            height: 20%;
            background: 
                conic-gradient(from 135deg at 25% 100%, #334155 0deg, #334155 90deg, transparent 90deg),
                conic-gradient(from 135deg at 75% 100%, #1e293b 0deg, #1e293b 90deg, transparent 90deg);
            background-size: 100px 100%;
            z-index: 2; /* ë‹¬ë³´ë‹¤ ì•ì— */
        }

        .ground-deco {
            bottom: 0;
            height: 40%;
            background-image: 
                radial-gradient(4px 4px at 50px 20px, #22c55e, transparent),
                radial-gradient(4px 4px at 150px 50px, #16a34a, transparent);
            background-size: 200px 100px;
            z-index: 3;
        }

        /* Characters */
        .character-container {
            position: absolute;
            bottom: 35%; /* On top of ground */
            left: 10%;
            display: flex;
            gap: 2px;
            transition: transform 0.1s;
            z-index: 10;
        }
        
        .char-sprite {
            font-size: 2.5rem;
            filter: drop-shadow(4px 0px 0px rgba(0,0,0,0.5));
            position: relative;
        }

        .walking .char-sprite {
            animation: bounce 0.4s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }

        /* Target Friend / Castle */
        .target-object {
            position: absolute;
            bottom: 35%;
            right: -50px; /* Starts off screen */
            font-size: 2.5rem;
            transition: right 0.1s linear;
            z-index: 9;
        }

        /* Modal for Memory */
        .pixel-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1f2937;
            border: 4px solid white;
            padding: 1rem;
            width: 80%;
            z-index: 50;
            text-align: center;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.5);
            display: none; /* Hidden by default */
        }

        .pixel-bar-bg {
            width: 80%;
            height: 10px;
            background: #374151;
            border: 2px solid white;
            position: absolute;
            bottom: 20px;
            left: 10%;
            z-index: 20;
        }
        .pixel-bar-fill {
            height: 100%;
            background: #fbbf24;
            width: 0%;
            transition: width 0.1s;
        }
    </style>
</head>
<body class="h-screen w-screen flex items-center justify-center bg-gray-900 relative">

    <div class="scanline"></div>

    <!-- ê²Œì„ ì»¨í…Œì´ë„ˆ -->
    <div class="w-full max-w-md h-full md:h-auto md:aspect-[9/16] bg-black md:border-4 md:border-gray-600 relative flex flex-col justify-between p-4 overflow-hidden">
        
        <!-- ìƒë‹¨: ë¹„ì£¼ì–¼ ì˜ì—­ -->
        <div id="game-screen" class="flex-1 border-4 border-white p-4 flex flex-col items-center justify-center bg-indigo-900 relative overflow-hidden">
            
            <!-- Scene 1: Start -->
            <div id="scene-start" class="text-center w-full z-20">
                <h1 class="text-3xl text-yellow-400 mb-8 leading-relaxed drop-shadow-md">
                    QUEST:<br>WEDDING<br>INVITATION
                </h1>
                <p class="text-sm text-gray-300 animate-pulse">TOUCH TO START</p>
            </div>

            <!-- Scene 2: Encounter -->
            <div id="scene-encounter" class="hidden flex flex-col items-center w-full z-20">
                <div class="text-6xl mb-4">ğŸ¤µğŸ‘°</div>
                <div class="text-xl text-yellow-300 mb-2">ì˜ˆë¹„ ë¶€ë¶€(ì´)ê°€<br>ë‚˜íƒ€ë‚¬ë‹¤!</div>
                <div class="w-full bg-black/50 p-2 text-xs text-left font-mono text-green-400 mt-4">
                    > HP: 100/100<br>
                    > MP: 100/100<br>
                    > ìƒíƒœ: ê²°í˜¼ ì¤€ë¹„ ì¤‘<br>
                    > ì•„ì´í…œ: ì²­ì²©ì¥ (ë ˆì–´)
                </div>
            </div>

             <!-- Scene 3: Reward Info -->
             <div id="scene-reward" class="hidden flex flex-col items-center w-full text-center z-20">
                <div class="text-5xl mb-6">ğŸ–ğŸº</div>
                <h2 class="text-xl text-yellow-300 mb-4">ë³´ìƒ ëª©ë¡</h2>
                <ul class="text-left text-sm space-y-2 w-3/4 mx-auto">
                    <li class="text-green-300">â˜… ì „ì„¤ì˜ ì²­ì²©ì¥</li>
                    <li class="text-blue-300">â˜… ë§›ìˆëŠ” ì‹ì‚¬ (SSSê¸‰)</li>
                    <li class="text-pink-300">â˜… ë¬´ì œí•œ ì£¼ë¥˜ & ìˆ˜ë‹¤</li>
                </ul>
            </div>

            <!-- Scene Game: Walking Quest (New!) -->
            <div id="scene-game" class="hidden w-full h-full absolute top-0 left-0">
                <div id="game-canvas">
                    <!-- Background Layers -->
                    <div class="bg-layer stars" id="bg-stars"></div>
                    <!-- ë‹¬ (Moon) ì¶”ê°€ -->
                    <div class="moon"></div>
                    <div class="bg-layer mountains" id="bg-mountains"></div>
                    <div class="bg-layer ground-deco" id="bg-ground"></div>

                    <!-- Game UI -->
                    <div class="absolute top-4 w-full text-center z-10">
                        <p class="text-yellow-300 text-xs animate-pulse bg-black/50 inline-block px-2 py-1 rounded">
                            í™”ë©´ì„ ê¾¹ ëˆŒëŸ¬ ì¹œêµ¬ë¥¼ ì°¾ìœ¼ì„¸ìš”!
                        </p>
                    </div>

                    <!-- Characters -->
                    <div class="character-container" id="player-party">
                        <div class="char-sprite">ğŸ‘°</div>
                    </div>

                    <!-- Target (Friend/Castle) -->
                    <div id="game-target" class="target-object">ğŸ‘©â€ğŸ¦°</div>

                    <!-- Progress Bar -->
                    <div class="pixel-bar-bg">
                        <div id="walk-progress" class="pixel-bar-fill"></div>
                    </div>

                    <!-- Memory Modal -->
                    <div id="memory-modal" class="pixel-modal">
                        <h3 class="text-yellow-400 mb-2 text-sm">ì¶”ì–µì„ ë°œê²¬í–ˆë‹¤!</h3>
                        <div id="modal-content" class="w-full aspect-video bg-gray-700 mb-4 flex items-center justify-center text-4xl border-2 border-white">
                            ğŸ“¸
                        </div>
                        <p id="modal-text" class="text-xs mb-4 text-gray-300">...</p>
                        <button id="modal-next-btn" class="pixel-btn text-white py-2 px-4 text-xs w-full">
                            ì¹œêµ¬ì™€ í•¨ê»˜ ê³„ì† ì°¾ê¸°
                        </button>
                    </div>
                </div>
            </div>

            <!-- Scene 4: Result -->
            <div id="scene-result" class="hidden flex flex-col items-center w-full overflow-y-auto z-20">
                <div class="text-4xl mb-4 animate-bounce">ğŸ‰ QUEST CLEAR! ğŸ‰</div>
                
                <div class="bg-gray-800 border-2 border-white p-4 w-full text-left text-sm mb-4">
                    <p class="text-yellow-300 mb-2">[ ë§Œë‚¨ì˜ ì¥ì†Œ ]</p>
                    <p class="mb-1">ğŸ“… ì¼ì‹œ: 2024ë…„ 5ì›” 20ì¼(í† ) 18:30</p>
                    <p class="mb-4">ğŸ“ ì¥ì†Œ: ë§›ìˆëŠ” ê³ ê¸°ì§‘ ê°•ë‚¨ì </p>
                    <p class="text-gray-400 text-xs">(ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123)</p>
                </div>

                <div class="bg-gray-800 border-2 border-white p-4 w-full text-left text-sm">
                   <p class="text-pink-300 mb-2">[ íŒŒí‹°ì› ì¤€ë¹„ë¬¼ ]</p>
                   <p>1. ë¹ˆ ì† (í•„ìˆ˜)</p>
                   <p>2. ì¶•í•˜í•˜ëŠ” ë§ˆìŒ</p>
                   <p>3. íŠ¼íŠ¼í•œ ê°„</p>
                </div>
            </div>

        </div>

        <!-- í•˜ë‹¨: ëŒ€í™”/ì»¨íŠ¸ë¡¤ ì˜ì—­ -->
        <div class="mt-4 h-48 border-4 border-white bg-blue-900 p-4 relative z-30">
            <div class="absolute top-0 left-4 -mt-3 bg-blue-900 px-2 text-yellow-300 text-xs border border-white">MESSAGE</div>
            
            <!-- í…ìŠ¤íŠ¸ ì¶œë ¥ ì˜ì—­ -->
            <div id="dialogue-box" class="text-white text-sm leading-6 cursor min-h-[60px]">
                <!-- JSë¡œ í…ìŠ¤íŠ¸ íƒ€ì´í•‘ -->
            </div>

            <!-- ë²„íŠ¼ ì˜ì—­ (ì„ íƒì§€) -->
            <div id="action-buttons" class="hidden mt-4 flex gap-2 justify-center">
                <!-- ë²„íŠ¼ì€ JSë¡œ ë™ì  ìƒì„± -->
            </div>
            
            <!-- ë‹¤ìŒ ë²„íŠ¼ (í™”ì‚´í‘œ) -->
            <div id="next-indicator" class="hidden absolute bottom-2 right-4 animate-bounce text-yellow-300 text-xl cursor-pointer">
                â–¼
            </div>
        </div>

    </div>

    <!-- JS Logic -->
    <script>
        // --- ì„¤ì • ë°ì´í„° ---
        const config = {
            groomName: "ì² ìˆ˜",
            brideName: "ì˜í¬",
            date: "2024ë…„ 5ì›” 20ì¼(í† ) ì˜¤í›„ 6ì‹œ 30ë¶„",
            locationName: "ë§›ìˆëŠ” ê³ ê¸°ì§‘ ê°•ë‚¨ì ",
            address: "ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123",
            mapLink: "https://map.naver.com",
            
            // ì¶”ì–µ ë°ì´í„° (ì¹œêµ¬ë¥¼ ë§Œë‚  ë•Œë§ˆë‹¤ í•˜ë‚˜ì”© ë‚˜ì˜´)
            // ì¹œêµ¬1, ì¹œêµ¬2, ì¹œêµ¬3, ì¹œêµ¬4 ìˆœì„œ
            // imgUrl ë¶€ë¶„ì— ì‹¤ì œ ì‚¬ì§„ ì£¼ì†Œë¥¼ ë„£ìœ¼ì„¸ìš” (ì˜ˆ: "./images/photo1.jpg" ë˜ëŠ” "https://...")
            memories: [
                { 
                    id: 1, 
                    text: "ê³ ë“±í•™êµ ì‹œì ˆ, ë§¤ì ì—ì„œ ë¹µ ë‚˜ëˆ ë¨¹ë˜ ìš°ë¦¬...", 
                    color: "bg-red-500", 
                    emoji: "ğŸ«", 
                    friendEmoji: "ğŸ‘©â€ğŸ¦°",
                    imgUrl: "https://via.placeholder.com/400x225/ef4444/ffffff?text=Photo+1" 
                },
                { 
                    id: 2, 
                    text: "ì²« í•´ì™¸ì—¬í–‰, ê¸¸ ìƒì–´ì„œ ìš¸ ë»”í–ˆë˜ ë‚ !", 
                    color: "bg-green-500", 
                    emoji: "âœˆï¸", 
                    friendEmoji: "ğŸ§‘â€ğŸ¦±",
                    imgUrl: "https://via.placeholder.com/400x225/22c55e/ffffff?text=Photo+2"
                },
                { 
                    id: 3, 
                    text: "ì·¨ì—… ì¤€ë¹„í•˜ëŠë¼ ë°¤ìƒˆë©° ì„œë¡œ ì‘ì›í–ˆë˜ ê¸°ì–µ", 
                    color: "bg-blue-500", 
                    emoji: "ğŸ’»", 
                    friendEmoji: "ğŸ‘±â€â™€ï¸",
                    imgUrl: "https://via.placeholder.com/400x225/3b82f6/ffffff?text=Photo+3"
                },
                { 
                    id: 4, 
                    text: "ë“œë””ì–´ ë‹¤ ëª¨ì˜€ë‹¤! ì´ì œ ì„±ìœ¼ë¡œ ê°€ì!", 
                    color: "bg-purple-500", 
                    emoji: "ğŸ™Œ", 
                    friendEmoji: "ğŸ‘§",
                    imgUrl: "https://via.placeholder.com/400x225/a855f7/ffffff?text=Photo+4"
                }
            ]
        };

        // --- ìƒíƒœ ê´€ë¦¬ ---
        let currentScene = 0;
        let isTyping = false;
        
        const dialogueBox = document.getElementById('dialogue-box');
        const nextIndicator = document.getElementById('next-indicator');
        const actionButtons = document.getElementById('action-buttons');
        const gameScreen = document.getElementById('game-screen');

        // --- ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ---
        const scenario = [
            {
                // 0: Start
                sceneId: 'scene-start',
                text: "ì•¼ìƒì˜ [ì²­ì²©ì¥ ëª¨ì„] í€˜ìŠ¤íŠ¸ê°€ ë°œìƒí–ˆë‹¤! í™”ë©´ì„ í„°ì¹˜í•˜ì„¸ìš”.",
                type: 'tap'
            },
            {
                // 1: Intro
                sceneId: 'scene-encounter',
                text: `ì•—! ${config.groomName}ì™€(ê³¼) ${config.brideName}ì´(ê°€) ë‚˜íƒ€ë‚¬ë‹¤! ê·¸ë“¤ì€ ë­”ê°€ ì¤„ ê²ƒì´ ìˆëŠ” ëˆˆì¹˜ë‹¤...`,
                type: 'next'
            },
            {
                // 2: Offer
                sceneId: 'scene-encounter',
                text: "\"ìš°ë¦¬ ê²°í˜¼í•´! ë§›ìˆëŠ” ë°¥ ì‚´ í…Œë‹ˆê¹Œ ì²­ì²©ì¥ ë°›ì•„ì¤„ë˜?\"",
                type: 'next'
            },
            {
                // 3: Reward
                sceneId: 'scene-reward',
                text: "í€˜ìŠ¤íŠ¸ ì™„ë£Œ ì‹œ ì—„ì²­ë‚œ ë³´ìƒì´ ê¸°ë‹¤ë¦¬ê³  ìˆë‹¤. íŒŒí‹°ì— ì°¸ì—¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                type: 'choice',
                choices: [
                    { text: "ìˆ˜ë½í•œë‹¤ (YES)", action: 'accept' },
                    { text: "ê±°ì ˆí•œë‹¤ (NO)", action: 'refuse' }
                ]
            },
            {
                // 4: Game Intro
                sceneId: 'scene-encounter', 
                text: "ì¢‹ì•„! í•˜ì§€ë§Œ ì´ˆëŒ€ì¥ì€ ì € ë©€ë¦¬ ì„±(Castle)ì— ìˆë‹¤ë„¤. í©ì–´ì§„ ì¹œêµ¬ë“¤ì„ ëª¨ì•„ í•¨ê»˜ ê°€ì!",
                type: 'next'
            },
            {
                // 5: Game Scene (Walking)
                sceneId: 'scene-game',
                text: "í™”ë©´ì„ ê¾¹ ëˆ„ë¥´ë©´ ì•ìœ¼ë¡œ ê±¸ì–´ê°‘ë‹ˆë‹¤. ì¹œêµ¬ë“¤ì„ ì°¾ì•„ì£¼ì„¸ìš”!",
                type: 'game'
            },
            {
                // 6: Result (Accept)
                sceneId: 'scene-result',
                text: `ëª¨ë‘ ì„±ì— ë„ì°©í–ˆë‹¤! ë´‰ì¸ì´ í•´ì œë˜ì–´ íŒŒí‹° ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.`,
                type: 'final',
                choices: [
                    { text: "ì§€ë„ ë³´ê¸°", action: 'map' },
                    { text: "ê²Œì„ ë‹¤ì‹œí•˜ê¸°", action: 'replay' }
                ]
            }
        ];

        // --- íƒ€ì´í•‘ íš¨ê³¼ í•¨ìˆ˜ ---
        function typeWriter(text, callback) {
            isTyping = true;
            dialogueBox.innerHTML = '';
            dialogueBox.classList.add('cursor');
            nextIndicator.classList.add('hidden');
            actionButtons.classList.add('hidden');

            let i = 0;
            const speed = 40; 

            function type() {
                if (i < text.length) {
                    dialogueBox.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else {
                    isTyping = false;
                    if (callback) callback();
                }
            }
            type();
        }

        // --- ì”¬ ì „í™˜ í•¨ìˆ˜ ---
        function showScene(index) {
            // ëª¨ë“  ì”¬ ìˆ¨ê¸°ê¸°
            ['scene-start', 'scene-encounter', 'scene-reward', 'scene-result', 'scene-game'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            
            // í˜„ì¬ ì”¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const data = scenario[index];
            
            // í™”ë©´ ë³´ì—¬ì£¼ê¸°
            const sceneEl = document.getElementById(data.sceneId);
            sceneEl.classList.remove('hidden');
            
            // ê²Œì„ ì”¬ì¼ ê²½ìš° íŠ¹ë³„ ì´ˆê¸°í™”
            if (data.type === 'game') {
                initWalkingGame();
            }

            // í…ìŠ¤íŠ¸ íƒ€ì´í•‘ ì‹œì‘
            typeWriter(data.text, () => {
                if (data.type === 'next' || data.type === 'tap') {
                    nextIndicator.classList.remove('hidden');
                } else if (data.type === 'choice' || data.type === 'final') {
                    showButtons(data.choices);
                    // ì¶”ê°€ë¨: ì´ˆëŒ€ì¥ì´ ë–´ì„ ë•Œë„ í­ì£½ íš¨ê³¼
                    if (data.type === 'final') {
                        confettiEffect();
                    }
                }
            });
        }

        // --- ë²„íŠ¼ ìƒì„± í•¨ìˆ˜ ---
        function showButtons(choices) {
            actionButtons.innerHTML = '';
            actionButtons.classList.remove('hidden');
            
            choices.forEach(choice => {
                const btn = document.createElement('button');
                
                let btnClass = "pixel-btn text-white py-2 px-4 text-xs md:text-sm font-bold w-full mb-2 border-2 border-white";
                
                if (choice.action === 'refuse') {
                    btnClass = "pixel-btn-red text-white py-2 px-4 text-xs md:text-sm font-bold w-full mb-2 border-2 border-white";
                } else if (choice.action === 'replay') {
                    // ë‹¤ì‹œí•˜ê¸°ëŠ” ì´ˆë¡ìƒ‰ ìŠ¤íƒ€ì¼
                    btnClass = "pixel-btn-green text-white py-2 px-4 text-xs md:text-sm font-bold w-full mb-2 border-2 border-white";
                }

                btn.className = btnClass;
                btn.innerText = choice.text;
                
                btn.onclick = () => handleAction(choice.action);
                actionButtons.appendChild(btn);
            });
        }

        // --- ì•¡ì…˜ ì²˜ë¦¬ í•¸ë“¤ëŸ¬ ---
        function handleAction(action) {
            if (action === 'accept') {
                currentScene++;
                showScene(currentScene);
            } else if (action === 'refuse') {
                dialogueBox.innerHTML = "ê±°ì ˆì€ ê±°ì ˆí•œë‹¤! <br>ì„ íƒì§€ëŠ” ì—†ë‹¤. ì–´ì„œ ìˆ˜ë½í•´ë¼!";
                gameScreen.classList.add('shake');
                setTimeout(() => gameScreen.classList.remove('shake'), 500);
            } else if (action === 'map') {
                window.open(config.mapLink, '_blank');
            } else if (action === 'replay') {
                // ê²Œì„ ë‹¤ì‹œí•˜ê¸°: ìƒíƒœ ë¦¬ì…‹ í›„ ì²« í™”ë©´ìœ¼ë¡œ
                currentScene = 0;
                showScene(0);
            }
        }

        // --- WALKING GAME LOGIC (NEW) ---
        let gameAnimationFrame;
        let isPressing = false;
        let gameStage = 0; // 0~3: Friends, 4: Castle
        let currentDistance = 0;
        const TARGET_DISTANCE = 100; // ê±¸ì–´ì•¼ í•˜ëŠ” ê±°ë¦¬ (ìƒëŒ€ê°’)
        const SPEED = 0.5;
        
        const playerPartyEl = document.getElementById('player-party');
        const gameTargetEl = document.getElementById('game-target');
        const walkProgressEl = document.getElementById('walk-progress');
        const bgStars = document.getElementById('bg-stars');
        const bgMountains = document.getElementById('bg-mountains');
        const bgGround = document.getElementById('bg-ground');
        
        // Modal Elements
        const memoryModal = document.getElementById('memory-modal');
        const modalContent = document.getElementById('modal-content');
        const modalText = document.getElementById('modal-text');
        const modalNextBtn = document.getElementById('modal-next-btn');

        function initWalkingGame() {
            gameStage = 0;
            currentDistance = 0;
            
            // ì´ˆê¸°í™”: ì‹ ë¶€ë§Œ ìˆìŒ
            playerPartyEl.innerHTML = '<div class="char-sprite">ğŸ‘°</div>';
            updateTarget();
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (PC + Mobile)
            const canvas = document.getElementById('game-canvas');
            
            const startWalk = (e) => { 
                if(e.cancelable) e.preventDefault(); 
                isPressing = true; 
                playerPartyEl.classList.add('walking');
            };
            const stopWalk = (e) => { 
                isPressing = false; 
                playerPartyEl.classList.remove('walking');
            };

            canvas.addEventListener('mousedown', startWalk);
            canvas.addEventListener('touchstart', startWalk);
            
            document.addEventListener('mouseup', stopWalk);
            document.addEventListener('touchend', stopWalk);
            
            // Modal Button
            modalNextBtn.onclick = nextStage;

            // Start Loop
            gameLoop();
        }

        function updateTarget() {
            if (gameStage < 4) {
                // ì¹œêµ¬ ì°¾ê¸°
                gameTargetEl.innerText = config.memories[gameStage].friendEmoji;
                gameTargetEl.style.fontSize = ""; // ê¸°ë³¸ í¬ê¸°
                dialogueBox.innerText = `ì¹œêµ¬ ${gameStage + 1}ì„(ë¥¼) ì°¾ìœ¼ëŸ¬ ê°€ëŠ” ì¤‘... (ê¾¹ ëˆ„ë¥´ì„¸ìš”)`;
            } else {
                // ì„± ì°¾ê¸° - ìˆ˜ì •ë¨: ì„± í¬ê¸° í‚¤ìš°ê¸°
                gameTargetEl.innerText = "ğŸ°";
                gameTargetEl.style.fontSize = "8rem"; 
                dialogueBox.innerText = "ì´ì œ ë‹¤ ëª¨ì˜€ë‹¤! ì„±ìœ¼ë¡œ ê°€ì! (ê¾¹ ëˆ„ë¥´ì„¸ìš”)";
            }
            // íƒ€ê²Ÿ ìœ„ì¹˜ ë¦¬ì…‹ (í™”ë©´ ì˜¤ë¥¸ìª½ ë°–)
            gameTargetEl.style.right = "-150px"; 
            walkProgressEl.style.width = "0%";
            currentDistance = 0;
        }

        function gameLoop() {
            if (isPressing && memoryModal.style.display !== 'block') {
                currentDistance += SPEED;
                
                // ë°°ê²½ ìŠ¤í¬ë¡¤ íš¨ê³¼ (Parallax)
                bgStars.style.backgroundPositionX = `-${currentDistance * 0.5}px`;
                bgMountains.style.backgroundPositionX = `-${currentDistance * 2}px`;
                bgGround.style.backgroundPositionX = `-${currentDistance * 4}px`;

                // íƒ€ê²Ÿ ë‹¤ê°€ì˜¤ê¸°
                // 80% ì§€ì ë¶€í„° íƒ€ê²Ÿì´ í™”ë©´ ì•ˆìœ¼ë¡œ ë“¤ì–´ì˜´
                if (currentDistance > 80) {
                    const offset = (currentDistance - 80) * 5; // ë¹ ë¥´ê²Œ ì ‘ê·¼
                    gameTargetEl.style.right = `${10 + offset}px`;
                }

                // Progress Bar
                walkProgressEl.style.width = `${Math.min(currentDistance, 100)}%`;

                // ë„ë‹¬ ì²´í¬
                if (currentDistance >= TARGET_DISTANCE) {
                    isPressing = false;
                    playerPartyEl.classList.remove('walking');
                    triggerEncounter();
                    return; // Loop pauses until modal closed
                }
            }
            
            if (currentScene === 5) { // ê²Œì„ ì”¬ì¼ ë•Œë§Œ ë£¨í”„
                gameAnimationFrame = requestAnimationFrame(gameLoop);
            }
        }

        function triggerEncounter() {
            if (gameStage < 4) {
                // ì¹œêµ¬ ë§Œë‚¨ -> ì¶”ì–µ íŒì—…
                const memory = config.memories[gameStage];
                
                // ëª¨ë‹¬ ë‚´ìš© ì±„ìš°ê¸° (ì´ë¯¸ì§€ í‘œì‹œ)
                // ì´ë¯¸ì§€ê°€ ê½‰ ì°¨ê²Œ ë³´ì´ë„ë¡ ìŠ¤íƒ€ì¼ ì¡°ì •
                modalContent.className = `w-full aspect-video mb-4 flex items-center justify-center overflow-hidden border-2 border-white bg-black relative`;
                
                if (memory.imgUrl) {
                    modalContent.innerHTML = `<img src="${memory.imgUrl}" alt="Memory" class="w-full h-full object-cover">`;
                } else {
                    // ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ë°±ì—… (ê¸°ì¡´ ë°©ì‹)
                    modalContent.classList.add(memory.color);
                    modalContent.innerHTML = `<span class="text-5xl">${memory.emoji}</span>`;
                }

                modalText.innerText = memory.text;
                modalNextBtn.innerText = "ì¹œêµ¬ í•©ë¥˜ & ê³„ì† ê°€ê¸°";
                
                memoryModal.style.display = 'block';
                dialogueBox.innerText = `ì¹œêµ¬ë¥¼ ë°œê²¬í–ˆë‹¤!`;

            } else {
                // ì„± ë„ì°© -> ì—”ë”©
                confettiEffect();
                setTimeout(() => {
                    currentScene++;
                    showScene(currentScene);
                }, 1000);
            }
        }

        function nextStage() {
            // ëª¨ë‹¬ ë‹«ê¸°
            memoryModal.style.display = 'none';
            
            // íŒŒí‹°ì› ì¶”ê°€
            const newFriend = document.createElement('div');
            newFriend.className = 'char-sprite';
            newFriend.innerText = config.memories[gameStage].friendEmoji;
            
            // ì£¼ì¸ê³µ ë’¤(ì™¼ìª½)ì— ì¶”ê°€ (prepend ì‚¬ìš©)
            playerPartyEl.prepend(newFriend);
            
            // ìŠ¤í…Œì´ì§€ ì¦ê°€
            gameStage++;
            
            // ë‹¤ìŒ ëª©í‘œ ì„¤ì •
            updateTarget();
            
            // ê²Œì„ ë£¨í”„ ì¬ê°œ
            gameLoop();
        }


        // --- í­ì£½ íš¨ê³¼ ---
        function confettiEffect() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'];
            for(let i=0; i<50; i++) {
                const div = document.createElement('div');
                div.style.position = 'absolute';
                div.style.left = '50%';
                div.style.top = '50%';
                div.style.width = '10px';
                div.style.height = '10px';
                div.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                div.style.transition = 'all 1s ease-out';
                div.style.zIndex = '100';
                
                const angle = Math.random() * Math.PI * 2;
                const velocity = 200 + Math.random() * 200;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;

                gameScreen.appendChild(div);

                setTimeout(() => {
                    div.style.transform = `translate(${tx}px, ${ty}px) scale(0)`;
                    div.style.opacity = '0';
                }, 10);

                setTimeout(() => div.remove(), 1000);
            }
        }

        // --- ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        document.body.addEventListener('click', (e) => {
            if (isTyping) return;
            // ê²Œì„ ì”¬ì—ì„œëŠ” í´ë¦­ìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ì•ŠìŒ
            if (scenario[currentScene].type === 'game') return;
            if (e.target.tagName === 'BUTTON') return; 

            const currentType = scenario[currentScene].type;
            
            if (currentType === 'tap' || currentType === 'next') {
                currentScene++;
                if (currentScene < scenario.length) {
                    showScene(currentScene);
                }
            }
        });

        // ì‹œì‘
        showScene(0);

    </script>
</body>
</html>