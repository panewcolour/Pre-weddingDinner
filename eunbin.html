<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-77L9RJF2MW"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-77L9RJF2MW');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²­ì²©ì¥ í€˜ìŠ¤íŠ¸: ì „ì„¤ì˜ ì‹œì‘</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- êµ¬ê¸€ í°íŠ¸ì—ì„œëŠ” Press Start 2Pë§Œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤ -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* ë‘¥ê·¼ëª¨ í°íŠ¸ ì›¹í°íŠ¸ ì •ì˜ (ëˆˆëˆ„ CDN - fastly ì‚¬ìš©) */
        @font-face {
            font-family: 'DungGeunMo';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        /* í°íŠ¸ ì ìš© ìˆœì„œ:
           1. 'Press Start 2P': ì˜ë¬¸, ìˆ«ì, ê¸°í˜¸ ìš°ì„  ì ìš©
           2. 'DungGeunMo': ìœ„ í°íŠ¸ì— ì—†ëŠ” ë¬¸ì(í•œê¸€)ì— ì ìš©
           3. cursive: í”½ì…€ í°íŠ¸ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì‹œìŠ¤í…œ ëŒ€ì²´ í°íŠ¸
        */
        body {
            font-family: 'Press Start 2P', 'DungGeunMo', cursive;
            background-color: #202020;
            color: white;
            /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ í—ˆìš©ì„ ìœ„í•´ hidden ì œê±° ë° xì¶•ë§Œ ìˆ¨ê¹€ ì²˜ë¦¬ */
            overflow-x: hidden; 
            user-select: none; /* ê¾¹ ëˆ„ë¥´ê¸° ì‹œ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
            -webkit-user-select: none;
        }

        .pixel-border {
            box-shadow: 
                -4px 0 0 0 white,
                4px 0 0 0 white,
                0 -4px 0 0 white,
                0 4px 0 0 white;
            margin: 4px;
        }

        .pixel-btn {
            background-color: #3b82f6;
            box-shadow: 
                -4px 0 0 0 #1d4ed8,
                4px 0 0 0 #1d4ed8,
                0 -4px 0 0 #1d4ed8,
                0 4px 0 0 #1d4ed8;
            transition: transform 0.1s;
        }
        
        .pixel-btn:active {
            transform: scale(0.95);
        }

        .pixel-btn-red {
            background-color: #ef4444;
            box-shadow: 
                -4px 0 0 0 #b91c1c,
                4px 0 0 0 #b91c1c,
                0 -4px 0 0 #b91c1c,
                0 4px 0 0 #b91c1c;
        }

        /* ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ìš© ì´ˆë¡ìƒ‰ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .pixel-btn-green {
            background-color: #10b981;
            box-shadow: 
                -4px 0 0 0 #059669,
                4px 0 0 0 #059669,
                0 -4px 0 0 #059669,
                0 4px 0 0 #059669;
        }

        /* ê¹œë¹¡ì´ëŠ” ì»¤ì„œ íš¨ê³¼ */
        .cursor::after {
            content: 'â–¼';
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .scanline {
            width: 100%;
            height: 100px;
            z-index: 10;
            background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(255, 255, 255, 0.1) 50%, rgba(0,0,0,0) 100%);
            opacity: 0.1;
            position: absolute;
            bottom: 100%;
            animation: scanline 10s linear infinite;
            pointer-events: none;
        }
        @keyframes scanline {
            0% { bottom: 100%; }
            100% { bottom: -100px; }
        }
        
        /* í”ë“¤ë¦¬ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* --- New Game Styles (Walking Game) --- */
        #game-canvas {
            position: relative;
            width: 100%;
            height: 100%;
            /* ë³€ê²½ëœ ë¶€ë¶„: ë…¸ì„ ê·¸ë¼ë°ì´ì…˜ (ë‚¨ìƒ‰ -> ë³´ë¼ -> ë¶„í™ -> ì£¼í™©) */
            background: linear-gradient(to bottom, #1e1b4b 0%, #4c1d95 30%, #be185d 60%, #f97316 85%, #fdba74 100%);
            overflow: hidden;
        }
        
        /* Pixel Background Elements */
        .bg-layer {
            position: absolute;
            width: 200%; /* Scrolling loop */
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        /* ë³„ ë°˜ì§ì„ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes twinkle {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.4; }
        }

        .stars {
            background-image: 
                /* ì‘ì€ ë³„ë“¤ */
                radial-gradient(1px 1px at 25px 5px, white, transparent),
                radial-gradient(1px 1px at 50px 25px, white, transparent),
                radial-gradient(1px 1px at 125px 20px, white, transparent),
                radial-gradient(1px 1px at 180px 10px, white, transparent),
                /* ì¤‘ê°„ ë³„ë“¤ */
                radial-gradient(1.5px 1.5px at 50px 75px, white, transparent),
                radial-gradient(1.5px 1.5px at 150px 40px, white, transparent),
                /* í° ë³„ë“¤ */
                radial-gradient(2px 2px at 15px 125px, white, transparent),
                radial-gradient(2.5px 2.5px at 110px 80px, white, transparent);
            background-size: 200px 200px;
            opacity: 0.8;
            animation: twinkle 4s infinite ease-in-out;
        }

        /* ë‹¬ (Moon) ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .moon {
            position: absolute;
            top: 10%;
            right: 15%;
            width: 50px;
            height: 50px;
            background: transparent;
            border-radius: 50%;
            /* ì´ˆìŠ¹ë‹¬ ëª¨ì–‘ ë§Œë“¤ê¸° */
            box-shadow: -10px 5px 0 0 #fde047; 
            filter: drop-shadow(0 0 10px #fde047); /* ë¹›ë‚˜ëŠ” íš¨ê³¼ */
            opacity: 0.9;
            z-index: 1;
        }

        .mountains {
            bottom: 40%;
            height: 20%;
            background: 
                conic-gradient(from 135deg at 25% 100%, #334155 0deg, #334155 90deg, transparent 90deg),
                conic-gradient(from 135deg at 75% 100%, #1e293b 0deg, #1e293b 90deg, transparent 90deg);
            background-size: 100px 100%;
            z-index: 2; /* ë‹¬ë³´ë‹¤ ì•ì— */
        }

        .ground-deco {
            bottom: 0;
            height: 40%;
            background-image: 
                radial-gradient(4px 4px at 50px 20px, #22c55e, transparent),
                radial-gradient(4px 4px at 150px 50px, #16a34a, transparent);
            background-size: 200px 100px;
            z-index: 3;
        }

        /* Characters */
        .character-container {
            position: absolute;
            bottom: 35%; /* On top of ground */
            left: 10%;
            display: flex;
            /* gap ëŒ€ì‹  ìŒìˆ˜ ë§ˆì§„ì„ ì‚¬ìš©í•´ ê²¹ì¹˜ê²Œ í•˜ê¸° ìœ„í•´ gap ì œê±° */
            /* gap: 4px; */
            transition: transform 0.1s;
            z-index: 10;
        }
        
        /* ìºë¦­í„° ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
        .char-sprite {
            width: 85px;  /* ì´ë¯¸ì§€ í¬ê¸° 60px -> 85pxë¡œ í™•ëŒ€ */
            height: 85px;
            filter: drop-shadow(4px 0px 0px rgba(0,0,0,0.5));
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            /* ìºë¦­í„°ë“¤ì´ ì„œë¡œ ê²¹ì¹˜ë„ë¡ ìŒìˆ˜ ë§ˆì§„ ì¶”ê°€ */
            margin-right: -35px; 
        }
        
        /* ì´ë¯¸ì§€ íƒœê·¸ ìŠ¤íƒ€ì¼ */
        .char-sprite img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* ë¹„ìœ¨ ìœ ì§€ */
            /* í”½ì…€ ì•„íŠ¸ ëŠë‚Œ */
            image-rendering: pixelated; 
        }

        /* ì´ëª¨ì§€ë‚˜ í…ìŠ¤íŠ¸ì¼ ê²½ìš° í°íŠ¸ í¬ê¸° ìœ ì§€ */
        .char-sprite span {
            font-size: 2.5rem;
        }

        .walking .char-sprite {
            animation: bounce 0.4s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }

        /* Target Friend / Castle */
        .target-object {
            position: absolute;
            bottom: 35%;
            right: -50px; /* Starts off screen */
            transition: right 0.1s linear;
            z-index: 9;
            /* íƒ€ê²Ÿë„ ì´ë¯¸ì§€ì¼ ìˆ˜ ìˆìœ¼ë‹ˆ flex ì²˜ë¦¬ */
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }
        
        .target-object img {
            width: 85px; /* íƒ€ê²Ÿ ì´ë¯¸ì§€ë„ ë™ì¼í•˜ê²Œ í‚¤ì›€ */
            height: 85px;
            object-fit: contain;
            image-rendering: pixelated;
        }

        /* Modal for Memory */
        .pixel-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1f2937;
            border: 4px solid white;
            padding: 0.5rem; /* Paddingì„ ì¤„ì—¬ì„œ ë‚´ìš©ì„ ë” ë„“ê²Œ */
            width: 95%; /* íŒì—… ë„ˆë¹„ í™•ëŒ€ (80% -> 95%) */
            z-index: 50;
            text-align: center;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.5);
            display: none; /* Hidden by default */
        }

        .pixel-bar-bg {
            width: 80%;
            height: 10px;
            background: #374151;
            border: 2px solid white;
            position: absolute;
            bottom: 20px;
            left: 10%;
            z-index: 20;
        }
        .pixel-bar-fill {
            height: 100%;
            background: #fbbf24;
            width: 0%;
            transition: width 0.1s;
        }

        /* Gallery Styles */
        .gallery-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #fbbf24;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen w-full flex items-center justify-center bg-gray-900 relative">

    <div class="scanline"></div>

    <!-- ë°°ê²½ìŒì•… (bgm.mp3) -->
    <audio id="bgm-audio" loop>
        <source src="https://panewcolour.github.io/Pre-weddingDinner/8bit.mp3" type="audio/mpeg">
    </audio>

    <!-- ê²Œì„ ì»¨í…Œì´ë„ˆ: h-full ëŒ€ì‹  min-h-screenì„ ì‚¬ìš©í•˜ì—¬ ë‚´ìš©ì´ ë§ìœ¼ë©´ ëŠ˜ì–´ë‚˜ë„ë¡ ìˆ˜ì • -->
    <div class="w-full max-w-md min-h-screen md:min-h-0 md:h-auto md:aspect-[9/16] bg-black md:border-4 md:border-gray-600 relative flex flex-col justify-between p-4">
        
        <!-- ìƒë‹¨: ë¹„ì£¼ì–¼ ì˜ì—­ -->
        <div id="game-screen" class="flex-1 border-4 border-white p-4 flex flex-col items-center justify-center bg-indigo-900 relative overflow-hidden">
            
            <!-- Scene 1: Start -->
            <div id="scene-start" class="text-center w-full z-20">
                <h1 class="text-3xl text-yellow-400 mb-8 leading-relaxed drop-shadow-md">
                    QUEST:<br>PRE-WEDDING<br>DINNER<br>INVITATION
                </h1>
                <p class="text-sm text-gray-300 animate-pulse">TOUCH TO START</p>
            </div>

            <!-- Scene 2: Encounter -->
            <div id="scene-encounter" class="hidden flex flex-col items-center w-full z-20">
                <div class="text-6xl mb-4">ğŸ¤µâ€â™‚ï¸ğŸ‘°â€â™€ï¸</div>
                <div class="text-xl text-yellow-300 mb-2">ì˜ˆë¹„ ë¶€ë¶€(ì´)ê°€<br>ë‚˜íƒ€ë‚¬ë‹¤!</div>
                <div class="w-full bg-black/50 p-2 text-xs text-left font-mono text-green-400 mt-4">
                    > HP: 930628/950222<br>
                    > MP: 251227/260314<br>
                    > ìƒíƒœ: ê²°í˜¼ ì¤€ë¹„ ì¤‘<br>
                    > ì•„ì´í…œ: ì²­ì²©ì¥ (ë ˆì–´)
                </div>
            </div>

             <!-- Scene 3: Reward Info -->
             <div id="scene-reward" class="hidden flex flex-col items-center w-full text-center z-20">
                <div class="text-5xl mb-6">ğŸ’ŒğŸ£ğŸ¾</div>
                <h2 class="text-xl text-yellow-300 mb-4">&lt;ë³´ìƒ ëª©ë¡&gt;</h2>
                <ul class="text-left text-sm space-y-2 w-3/4 mx-auto">
                    <li class="text-green-300">â˜… ì „ì„¤ì˜ ì²­ì²©ì¥</li>
                    <li class="text-blue-300">â˜… ë§›ìˆëŠ” ì‹ì‚¬ (SSSê¸‰)</li>
                    <li class="text-pink-300">â˜… ë¬´ì œí•œ ìˆ˜ë‹¤ & ì£¼ë¥˜</li>
                </ul>
            </div>

            <!-- Scene 3.5: Quest Start (New Added) -->
            <div id="scene-quest-start" class="hidden flex flex-col items-center w-full text-center z-20">
                <div class="text-6xl mb-6 animate-pulse">ğŸ“œ</div>
                <h2 class="text-2xl text-red-400 mb-4 drop-shadow-md">MISSION START</h2>
                <div class="bg-gray-800 border-2 border-white p-4 w-full text-left text-xs md:text-sm leading-relaxed">
                    <p class="text-yellow-300 mb-2 border-b border-gray-500 pb-1">>> ì‘ì „ëª…: ì¢…ë¡œê¸ˆë¶•ì–´</p>
                    <p>1. í©ì–´ì§„ <span class="text-blue-300">ì¹œêµ¬ë“¤</span>ì„ ëª¨ë‘ ì°¾ìœ¼ì‹œì˜¤.</p>
                    <p>2. ë¬´ì‚¬íˆ <span class="text-purple-300">ì¢…ë¡œí•™ì›(Castle)</span>ì— ë„ì°©í•˜ì‹œì˜¤.</p>
                    <p class="mt-2 text-gray-400 text-[10px]">* ì‹¤íŒ¨ ì‹œ ì¶•ì˜ê¸ˆ 2ë°° (ë¡±ë‹´)</p>
                </div>
            </div>

            <!-- Scene Game: Walking Quest (New!) -->
            <div id="scene-game" class="hidden w-full h-full absolute top-0 left-0">
                <div id="game-canvas">
                    <!-- Background Layers -->
                    <div class="bg-layer stars" id="bg-stars"></div>
                    <!-- ë‹¬ (Moon) ì¶”ê°€ -->
                    <div class="moon"></div>
                    <div class="bg-layer mountains" id="bg-mountains"></div>
                    <div class="bg-layer ground-deco" id="bg-ground"></div>

                    <!-- Game UI -->
                    <div class="absolute top-4 w-full text-center z-10">
                        <p class="text-yellow-300 text-xs animate-pulse bg-black/50 inline-block px-2 py-1 rounded">
                            í™”ë©´ì„ ê¾¹ ëˆŒëŸ¬ ì¹œêµ¬ë¥¼ ì°¾ìœ¼ì„¸ìš”!
                        </p>
                    </div>

                    <!-- Characters -->
                    <div class="character-container" id="player-party">
                        <!-- ì´ˆê¸° ìºë¦­í„°ëŠ” JSì—ì„œ ì´ë¯¸ì§€ë¡œ ì‚½ì…ë¨ -->
                    </div>

                    <!-- Target (Friend/Castle) -->
                    <div id="game-target" class="target-object">
                        <!-- íƒ€ê²Ÿë„ JSì—ì„œ ì´ë¯¸ì§€ë¡œ ì‚½ì…ë¨ -->
                    </div>

                    <!-- Progress Bar -->
                    <div class="pixel-bar-bg">
                        <div id="walk-progress" class="pixel-bar-fill"></div>
                    </div>

                    <!-- Memory Modal -->
                    <div id="memory-modal" class="pixel-modal">
                        <h3 class="text-yellow-400 mb-2 text-sm">ì¶”ì–µì¡°ê°ì„ ë°œê²¬í–ˆë‹¤!</h3>
                        <!-- ìˆ˜ì •ë¨: ê°€ë³€ ë†’ì´ ë° ë„ˆë¹„ í—ˆìš© (aspect-square ì œê±°) -->
                        <div id="modal-content" class="w-full flex items-center justify-center mb-4 border-2 border-white bg-black">
                            ğŸ“¸
                        </div>
                        <p id="modal-text" class="text-xs mb-4 text-gray-300">...</p>
                        <button id="modal-next-btn" class="pixel-btn text-white py-2 px-4 text-xs w-full">
                            ì¹œêµ¬ì™€ í•¨ê»˜ ê³„ì† ì°¾ê¸°
                        </button>
                    </div>
                </div>
            </div>

            <!-- Scene 5.5: Photo Gallery (New!) -->
            <div id="scene-gallery" class="hidden w-full h-full absolute top-0 left-0 z-20 bg-black flex flex-col items-center justify-center">
                <div class="gallery-counter" id="gallery-counter">1 / 20</div>
                <h2 class="text-yellow-400 mb-4 text-sm animate-pulse">MEMORIES UNLOCKED</h2>
                
                <!-- ìˆ˜ì •ë¨: ì‚¬ì§„ ë¹„ìœ¨ ì•ˆ ê¹¨ì§€ê²Œ ì»¨í…Œì´ë„ˆ ë†’ì´ì™€ object-contain ì‚¬ìš© -->
                <div class="w-full h-[60vh] p-4 flex items-center justify-center">
                    <img id="gallery-img" src="" alt="Gallery Image" class="max-w-full max-h-full border-4 border-white object-contain shadow-lg">
                </div>
                
                <p class="text-gray-400 text-xs mt-4 animate-bounce">â–¼ í™”ë©´ì„ í„°ì¹˜í•˜ì—¬ ë„˜ê¸°ì„¸ìš”</p>
            </div>

            <!-- Scene 6: Result -->
            <div id="scene-result" class="hidden flex flex-col items-center w-full z-20">
                <div class="text-4xl mb-4 animate-bounce">ğŸ‰ QUEST CLEAR! ğŸ‰</div>
                
                <div class="bg-gray-800 border-2 border-white p-4 w-full text-left text-sm mb-4">
                    <p class="text-yellow-300 mb-2">[ ë§Œë‚¨ì˜ ì¥ì†Œ ]</p>
                    <p class="mb-1">ğŸ“… ì¼ì‹œ: 2025ë…„ 12ì›” 27ì¼(í† ) 17:00</p>
                    <p class="mb-4">ğŸ“ ì¥ì†Œ: ê°“í¬ëª¨ë¡œë¯¸ ì—¬ì˜ë„ì </p>
                    <p class="text-gray-400 text-xs">(ì„œìš¸ ì˜ë“±í¬êµ¬ ì—¬ì˜ëŒ€ë°©ë¡œ65ê¸¸ 23)</p>
                </div>

                <div class="bg-gray-800 border-2 border-white p-4 w-full text-left text-sm">
                   <p class="text-pink-300 mb-2">[ íŒŒí‹°ì› ì¤€ë¹„ë¬¼ ]</p>
                   <p>1. ì¶•í•˜í•˜ëŠ” ë§ˆìŒ</p>
                   <p>2. ë¹ˆ ì† (í•„ìˆ˜)</p>
                   <p>3. ì‰¬ì§€ ì•Šì„ ì…</p>
                   <p>4. íŠ¼íŠ¼í•œ ê°„</p>
                </div>
            </div>

        </div>

        <!-- í•˜ë‹¨: ëŒ€í™”/ì»¨íŠ¸ë¡¤ ì˜ì—­ -->
        <div class="mt-4 h-48 border-4 border-white bg-blue-900 p-4 relative z-30">
            <div class="absolute top-0 left-4 -mt-3 bg-blue-900 px-2 text-yellow-300 text-xs border border-white">MESSAGE</div>
            
            <!-- í…ìŠ¤íŠ¸ ì¶œë ¥ ì˜ì—­ -->
            <div id="dialogue-box" class="text-white text-sm leading-6 cursor min-h-[60px]">
                <!-- JSë¡œ í…ìŠ¤íŠ¸ íƒ€ì´í•‘ -->
            </div>

            <!-- ë²„íŠ¼ ì˜ì—­ (ì„ íƒì§€) -->
            <div id="action-buttons" class="hidden mt-4 flex gap-2 justify-center">
                <!-- ë²„íŠ¼ì€ JSë¡œ ë™ì  ìƒì„± -->
            </div>
            
            <!-- ë‹¤ìŒ ë²„íŠ¼ (í™”ì‚´í‘œ) -->
            <div id="next-indicator" class="hidden absolute bottom-2 right-4 animate-bounce text-yellow-300 text-xl cursor-pointer">
                â–¼
            </div>

             <!-- ì†Œë¦¬ ì¡°ì ˆ ë²„íŠ¼ (ìœ„ì¹˜ ë³€ê²½ë¨: ë©”ì‹œì§€ì°½ ë‚´ë¶€ ì™¼ìª½ ì•„ë˜, í¬ê¸° ì¤„ì„) -->
             <div id="sound-btn" class="absolute bottom-2 left-4 z-50 cursor-pointer text-sm p-1 bg-black/50 rounded hover:bg-black/70 transition hidden text-white border border-white/30">
                ğŸ”Š
            </div>
        </div>

    </div>

    <!-- JS Logic -->
    <script>
        // --- ì„¤ì • ë°ì´í„° ---
        const config = {
            groomName: "ì„±ì°¬",
            brideName: "ì€ë¹ˆ",
            date: "2025ë…„ 12ì›” 27ì¼(í† ) ì˜¤í›„ 5ì‹œ",
            locationName: "ê°“í¬ëª¨ë¡œë¯¸ ì—¬ì˜ë„ì ",
            address: "ì„œìš¸ ì˜ë“±í¬êµ¬ ì—¬ì˜ëŒ€ë°©ë¡œ65ê¸¸ 23",
            mapLink: "https://naver.me/xI1k3QzY",
            
            // [ì´ë¯¸ì§€ ì„¤ì •]
            brideImg: "https://i.ifh.cc/OAkMFo.png", // ì‹ ë¶€(ì£¼ì¸ê³µ) ì´ë¯¸ì§€
            
            // [ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ì„¤ì •]
            galleryImages: [
                "https://i.ifh.cc/cp6MlV.jpg",
                "https://i.ifh.cc/4bV81C.jpg",
                "https://i.ifh.cc/CgJ36Z.jpg",
                "https://i.ifh.cc/fXy1Aw.jpg",
                "https://i.ifh.cc/fc77b9.jpg",
                "https://i.ifh.cc/RMOgrq.jpg",
                "https://i.ifh.cc/rywCaM.jpg",
                "https://i.ifh.cc/MhdfhM.jpg",
                "https://i.ifh.cc/XYMgv7.jpg",
                "https://i.ifh.cc/8TK0ck.jpg",
                "https://i.ifh.cc/hyD7hK.jpg",
                "https://i.ifh.cc/FsJrwQ.jpg",
                "https://i.ifh.cc/WY0JrL.jpg",
                "https://i.ifh.cc/nhcbsL.jpg",
                "https://i.ifh.cc/rmBRXO.jpg",
                "https://i.ifh.cc/7GkfH0.jpg",
                "https://i.ifh.cc/fLhaO0.jpg",
                "https://i.ifh.cc/T5bHOB.jpg",
                "https://i.ifh.cc/y3hoFg.jpg",
                "https://i.ifh.cc/2jfVmW.jpg"
            ],

            // ì¶”ì–µ ë°ì´í„° (ì¹œêµ¬ë¥¼ ë§Œë‚  ë•Œë§ˆë‹¤ í•˜ë‚˜ì”© ë‚˜ì˜´)
            memories: [
                { 
                    id: 1, 
                    encounterMsg: "ê²½ë¯¼ì„(ë¥¼) ë°œê²¬í–ˆë‹¤! ê°™ì€ ë‹¬ì— íƒœì–´ë‚œ ìš°ë¦°ì¹­êµ¬ì¹­ê¸”", // ê° ì¹œêµ¬ ë°œê²¬ ì‹œ ëœ° ë©”ì‹œì§€
                    text: "ì¬ìˆ˜ ëë‚˜ê³  ê±°ì˜ ì²¨ìœ¼ë¡œ ìˆ ë§ˆì‹  ì‹œì ˆ...?", 
                    color: "bg-red-500", 
                    emoji: "ğŸ«", 
                    // [ì¹œêµ¬ ì´ë¯¸ì§€ ì„¤ì •]
                    characterImg: "https://i.ifh.cc/NM0vb9.png",
                    imgUrl: "https://i.ifh.cc/3tOGA2.jpg" 
                },
                { 
                    id: 2, 
                    encounterMsg: "ë¯¼ì •ì„(ë¥¼) ë°œê²¬í–ˆë‹¤! ëª¨ë“  ê³„íšì€ ìš°ë¦¬ê°€ ë‹´ë‹¹í•˜ì§€!!",
                    text: "ìš°ë¦¬ì˜ ì²« ì—¬í–‰ê³¼ ë‘ ë²ˆì§¸ ì—¬í–‰,\në¶€ì‚°ë²„ìŠ¤ìš°ë¦¬ê°€ë¨¹ìŒì•”íŠ¼ê·¸ëŸ¼", 
                    color: "bg-green-500", 
                    emoji: "âœˆï¸", 
                    characterImg: "https://i.ifh.cc/x8mn8S.png",
                    imgUrl: "https://i.ifh.cc/3tYBP4.jpg"
                },
                { 
                    id: 3, 
                    encounterMsg: "ì¬ìœ¤ì„(ë¥¼) ë°œê²¬í–ˆë‹¤! ìš°ë¦¬ê°€ ë§Œë‚˜ë©´ ëˆˆë¬¼ë‘ë°°ì´ë²¤íŠ¸ã… ã… ã… ã… ã… ã… ã… ",
                    text: "ì›Œì»¤íì—ì„œ, ì½”ë¡œë‚˜ì—¬ë„ ë§›ë‚œê±° í¬ê¸°ëª»í•´ã…ã…ã…ã…", 
                    color: "bg-blue-500", 
                    emoji: "ğŸ’»", 
                    characterImg: "https://i.ifh.cc/qdbL1X.png",
                    imgUrl: "https://i.ifh.cc/cR31BM.jpg"
                },
                { 
                    id: 4, 
                    encounterMsg: "í˜„ê²½ì„(ë¥¼) ë°œê²¬í–ˆë‹¤! ë‚˜ì™”ë‹¤ ë‚´ MBTI ë³µì‚¬ë³¸",
                    text: "2 2 S2 2 2\në“œë””ì–´ ë‹¤ ëª¨ì˜€ë‹¤! ì´ì œ ì¢…ë¡œí•™ì›ìœ¼ë¡œ ê°€ì!", 
                    color: "bg-purple-500", 
                    emoji: "ğŸ™Œ", 
                    characterImg: "https://i.ifh.cc/n76AdV.png",
                    imgUrl: "https://i.ifh.cc/FXo2Jf.jpg"
                }
            ]
        };

        // --- ìƒíƒœ ê´€ë¦¬ ---
        let currentScene = 0;
        let isTyping = false;
        let galleryIndex = 0;
        
        const dialogueBox = document.getElementById('dialogue-box');
        const nextIndicator = document.getElementById('next-indicator');
        const actionButtons = document.getElementById('action-buttons');
        const gameScreen = document.getElementById('game-screen');
        
        // --- BGM ê´€ë ¨ ì½”ë“œ (New) ---
        const bgmAudio = document.getElementById('bgm-audio');
        const soundBtn = document.getElementById('sound-btn');
        let isMusicPlaying = false;

        // ì†Œë¦¬ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
        soundBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // ë°°ê²½ í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
            
            if (bgmAudio.paused) {
                bgmAudio.play();
                soundBtn.innerText = "ğŸ”Š";
                isMusicPlaying = true;
            } else {
                bgmAudio.pause();
                soundBtn.innerText = "ğŸ”‡";
                isMusicPlaying = false;
            }
        });

        // BGM ì‹œì‘ í•¨ìˆ˜
        function startBgm() {
            if (!isMusicPlaying) {
                bgmAudio.volume = 0.5; // ë³¼ë¥¨ 50%
                bgmAudio.play().then(() => {
                    isMusicPlaying = true;
                    soundBtn.innerText = "ğŸ”Š";
                    soundBtn.classList.remove('hidden'); // ì¬ìƒ ì„±ê³µ ì‹œ ë²„íŠ¼ ë³´ì´ê¸°
                }).catch(e => {
                    console.log("Audio play failed (waiting for interaction):", e);
                    // ìë™ ì¬ìƒ ì‹¤íŒ¨ ì‹œ ë²„íŠ¼ì„ ìŒì†Œê±° ìƒíƒœë¡œë¼ë„ ë³´ì—¬ì¤Œ
                    soundBtn.innerText = "ğŸ”‡";
                    soundBtn.classList.remove('hidden');
                });
            }
        }

        // --- ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ---
        const scenario = [
            {
                // 0: Start
                sceneId: 'scene-start',
                text: "ì•¼ìƒì˜ [ì²­ì²©ì¥ ëª¨ì„] í€˜ìŠ¤íŠ¸ê°€ ë°œìƒí–ˆë‹¤! í™”ë©´ì„ í„°ì¹˜í•˜ì„¸ìš”.",
                type: 'tap'
            },
            {
                // 1: Intro
                sceneId: 'scene-encounter',
                text: `ì•—!!! ${config.brideName}ì™€(ê³¼) ${config.groomName}ì´(ê°€) ë‚˜íƒ€ë‚¬ë‹¤! ê·¸ë“¤ì€ ë­”ê°€ ì¤„ ê²ƒì´ ìˆëŠ” ëˆˆì¹˜ë‹¤...`,
                type: 'next'
            },
            {
                // 2: Offer
                sceneId: 'scene-encounter',
                text: "\"ìš°ë¦¬ ê²°í˜¼í•´! ë§›ìˆëŠ” ì‹ì‚¬ì™€ í•¨ê»˜ ì²­ì²©ì¥ ë°›ì•„ì¤„ë˜?\"",
                type: 'next'
            },
            {
                // 3: Reward
                sceneId: 'scene-reward',
                text: "í€˜ìŠ¤íŠ¸ ì™„ë£Œ ì‹œ ì—„ì²­ë‚œ ë³´ìƒì´ ê¸°ë‹¤ë¦¬ê³  ìˆë‹¤. íŒŒí‹°ì— ì°¸ì—¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                type: 'choice',
                choices: [
                    { text: "ì ë“œê°€ì", action: 'accept' },
                    { text: "ì´ë¶ˆ ì†ìœ¼ë¡œ ë“œê°€ì", action: 'refuse' }
                ]
            },
            {
                // 4: Quest Start
                sceneId: 'scene-quest-start', 
                text: "í€˜ìŠ¤íŠ¸ê°€ ìˆ˜ë½ë˜ì—ˆë‹¤! í•˜ì§€ë§Œ ì¢…ë¡œí•™ì›ìœ¼ë¡œ ê°€ëŠ” ê¸¸ì€ ë©€ê³  í—˜ë‚œí•˜ì§€. ì¹œêµ¬ë“¤ì„ ëª¨ì•„ í•¨ê»˜ ì§„ê²©í•˜ë¼!",
                type: 'next'
            },
            {
                // 5: Game Scene (Walking)
                sceneId: 'scene-game',
                text: "í™”ë©´ì„ ê¾¹ ëˆ„ë¥´ë©´ ì•ìœ¼ë¡œ ê±¸ì–´ê°‘ë‹ˆë‹¤. í©ì–´ì§„ ì¹œêµ¬ë“¤ì„ ì°¾ì•„ì£¼ì„¸ìš”!",
                type: 'game'
            },
            {
                // 6: Gallery Scene (New!)
                sceneId: 'scene-gallery',
                text: "ì¢…ë¡œí•™ì› ë¬¸ì˜ ë´‰ì¸ì„ í•´ì œí•˜ëŠ” ì¤‘.. ê°‘ìê¸° ê¸°ì–µì˜ ì¡°ê°ë“¤ì´ í˜ëŸ¬ë“¤ì–´ì˜¨ë‹¤...",
                type: 'gallery'
            },
            {
                // 7: Result (Accept)
                sceneId: 'scene-result',
                text: `ëª¨ë‘ ì¢…ë¡œí•™ì›ì— ë„ì°©í–ˆë‹¤! ë´‰ì¸ì´ í•´ì œë˜ì–´ íŒŒí‹° ì •ë³´ê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.`,
                type: 'final',
                choices: [
                    { text: "ì§€ë„ ë³´ê¸°", action: 'map' },
                    { text: "ê²Œì„ ë‹¤ì‹œí•˜ê¸°", action: 'replay' }
                ]
            }
        ];

        // --- íƒ€ì´í•‘ íš¨ê³¼ í•¨ìˆ˜ ---
        function typeWriter(text, callback) {
            isTyping = true;
            dialogueBox.innerHTML = '';
            dialogueBox.classList.add('cursor');
            nextIndicator.classList.add('hidden');
            actionButtons.classList.add('hidden');

            let i = 0;
            const speed = 40; 

            function type() {
                if (i < text.length) {
                    dialogueBox.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else {
                    isTyping = false;
                    if (callback) callback();
                }
            }
            type();
        }

        // --- ì”¬ ì „í™˜ í•¨ìˆ˜ ---
        function showScene(index) {
            // ëª¨ë“  ì”¬ ìˆ¨ê¸°ê¸°
            ['scene-start', 'scene-encounter', 'scene-reward', 'scene-quest-start', 'scene-result', 'scene-game', 'scene-gallery'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.classList.add('hidden');
            });
            
            // í˜„ì¬ ì”¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const data = scenario[index];
            
            // í™”ë©´ ë³´ì—¬ì£¼ê¸°
            const sceneEl = document.getElementById(data.sceneId);
            sceneEl.classList.remove('hidden');
            
            // íŠ¹ìˆ˜ ì”¬ ì´ˆê¸°í™”
            if (data.type === 'game') {
                initWalkingGame();
            } else if (data.type === 'gallery') {
                initGallery();
            }

            // í…ìŠ¤íŠ¸ íƒ€ì´í•‘ ì‹œì‘
            typeWriter(data.text, () => {
                if (data.type === 'next' || data.type === 'tap') {
                    nextIndicator.classList.remove('hidden');
                } else if (data.type === 'choice' || data.type === 'final') {
                    showButtons(data.choices);
                    // ì¶”ê°€ë¨: ì´ˆëŒ€ì¥ì´ ë–´ì„ ë•Œë„ í­ì£½ íš¨ê³¼
                    if (data.type === 'final') {
                        confettiEffect();
                    }
                }
            });
        }

        // --- ê°¤ëŸ¬ë¦¬ ë¡œì§ (New) ---
        function initGallery() {
            galleryIndex = 0;
            updateGalleryImage();
        }

        function updateGalleryImage() {
            const imgEl = document.getElementById('gallery-img');
            const counterEl = document.getElementById('gallery-counter');
            
            // í˜ì´ë“œ íš¨ê³¼ë¥¼ ìœ„í•´ í´ë˜ìŠ¤ ì ì‹œ ì œê±° í›„ ì¶”ê°€
            imgEl.classList.remove('fade-in');
            void imgEl.offsetWidth; // trigger reflow
            imgEl.classList.add('fade-in');

            imgEl.src = config.galleryImages[galleryIndex];
            counterEl.innerText = `${galleryIndex + 1} / ${config.galleryImages.length}`;
        }

        function nextGalleryImage() {
            galleryIndex++;
            if (galleryIndex < config.galleryImages.length) {
                updateGalleryImage();
            } else {
                // ê°¤ëŸ¬ë¦¬ ë -> ë‹¤ìŒ ì”¬ìœ¼ë¡œ
                currentScene++;
                showScene(currentScene);
            }
        }

        // --- ë²„íŠ¼ ìƒì„± í•¨ìˆ˜ ---
        function showButtons(choices) {
            actionButtons.innerHTML = '';
            actionButtons.classList.remove('hidden');
            
            choices.forEach(choice => {
                const btn = document.createElement('button');
                
                let btnClass = "pixel-btn text-white py-2 px-4 text-xs md:text-sm font-bold w-full mb-2 border-2 border-white";
                
                if (choice.action === 'refuse') {
                    btnClass = "pixel-btn-red text-white py-2 px-4 text-xs md:text-sm font-bold w-full mb-2 border-2 border-white";
                } else if (choice.action === 'replay') {
                    // ë‹¤ì‹œí•˜ê¸°ëŠ” ì´ˆë¡ìƒ‰ ìŠ¤íƒ€ì¼
                    btnClass = "pixel-btn-green text-white py-2 px-4 text-xs md:text-sm font-bold w-full mb-2 border-2 border-white";
                }

                btn.className = btnClass;
                btn.innerText = choice.text;
                
                btn.onclick = () => handleAction(choice.action);
                actionButtons.appendChild(btn);
            });
        }

        // --- ì•¡ì…˜ ì²˜ë¦¬ í•¸ë“¤ëŸ¬ ---
        function handleAction(action) {
            if (action === 'accept') {
                currentScene++;
                showScene(currentScene);
            } else if (action === 'refuse') {
                dialogueBox.innerHTML = "í˜¸ë‘ê°€ ë¯¸ì¹œë“¯ì´ ì§–ì–´ëŒ„ë‹¤.<br>ì¿ í‚¤ê°€ ê°‘ìê¸° ì£¼ë¨¹ì§ˆì„ í•œë‹¤..<br>ë„ì €íˆ ì ì„ ì˜ ìˆ˜ê°€ ì—†ë‹¤...";
                gameScreen.classList.add('shake');
                setTimeout(() => gameScreen.classList.remove('shake'), 500);
            } else if (action === 'map') {
                window.open(config.mapLink, '_blank');
            } else if (action === 'replay') {
                // ê²Œì„ ë‹¤ì‹œí•˜ê¸°: ìƒíƒœ ë¦¬ì…‹ í›„ ì²« í™”ë©´ìœ¼ë¡œ
                currentScene = 0;
                showScene(0);
                // BGMì´ êº¼ì ¸ìˆìœ¼ë©´ ë‹¤ì‹œ ì¼¤ ê¸°íšŒ ì œê³µ (ì„ íƒì‚¬í•­)
                // if(bgmAudio.paused) startBgm(); 
            }
        }

        // --- WALKING GAME LOGIC (NEW) ---
        let gameAnimationFrame;
        let isPressing = false;
        let gameStage = 0; // 0~3: Friends, 4: Castle
        let currentDistance = 0;
        const TARGET_DISTANCE = 100; // ê±¸ì–´ì•¼ í•˜ëŠ” ê±°ë¦¬ (ìƒëŒ€ê°’)
        const SPEED = 0.5;
        
        const playerPartyEl = document.getElementById('player-party');
        const gameTargetEl = document.getElementById('game-target');
        const walkProgressEl = document.getElementById('walk-progress');
        const bgStars = document.getElementById('bg-stars');
        const bgMountains = document.getElementById('bg-mountains');
        const bgGround = document.getElementById('bg-ground');
        
        // Modal Elements
        const memoryModal = document.getElementById('memory-modal');
        const modalContent = document.getElementById('modal-content');
        const modalText = document.getElementById('modal-text');
        const modalNextBtn = document.getElementById('modal-next-btn');

        function initWalkingGame() {
            gameStage = 0;
            currentDistance = 0;
            
            // ì´ˆê¸°í™”: ì‹ ë¶€ë§Œ ìˆìŒ (ì´ëª¨ì§€ ëŒ€ì‹  ì´ë¯¸ì§€ íƒœê·¸ ì‚¬ìš©)
            playerPartyEl.innerHTML = `
                <div class="char-sprite">
                    <img src="${config.brideImg}" alt="Bride">
                </div>
            `;
            updateTarget();
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (PC + Mobile)
            const canvas = document.getElementById('game-canvas');
            
            const startWalk = (e) => { 
                // ìˆ˜ì •: ëª¨ë‹¬ì´ ë– ìˆê±°ë‚˜ ë²„íŠ¼ í´ë¦­ ì‹œì—ëŠ” ê²Œì„ ì¡°ì‘ ë¬´ì‹œ ë° ì´ë²¤íŠ¸ í†µê³¼
                if (memoryModal.style.display === 'block' || e.target.tagName === 'BUTTON') return;
                
                if(e.cancelable) e.preventDefault(); 
                isPressing = true; 
                playerPartyEl.classList.add('walking');
            };
            const stopWalk = (e) => { 
                isPressing = false; 
                playerPartyEl.classList.remove('walking');
            };

            canvas.addEventListener('mousedown', startWalk);
            // ìˆ˜ì •: ëª¨ë°”ì¼ í„°ì¹˜ ì‹œ ìŠ¤í¬ë¡¤ ë°©ì§€ë¥¼ ìœ„í•´ passive: false ì˜µì…˜ ì¶”ê°€
            canvas.addEventListener('touchstart', startWalk, { passive: false });
            
            document.addEventListener('mouseup', stopWalk);
            document.addEventListener('touchend', stopWalk);
            
            // Modal Button
            modalNextBtn.onclick = nextStage;

            // Start Loop
            gameLoop();
        }

        function updateTarget() {
            if (gameStage < 4) {
                // ì¹œêµ¬ ì°¾ê¸° (ì´ë¯¸ì§€ë¡œ í‘œì‹œ)
                const charImg = config.memories[gameStage].characterImg;
                gameTargetEl.innerHTML = `<img src="${charImg}" alt="Friend">`;
                gameTargetEl.style.fontSize = ""; // ê¸°ë³¸ í¬ê¸°
                dialogueBox.innerText = `ì¹œêµ¬ë¥¼ ì°¾ìœ¼ëŸ¬ ê°€ëŠ” ì¤‘... ëˆ„ê°€ ë¨¼ì € ë‚˜íƒ€ë‚ ê¹Œ?`;
            } else {
                // ì„± ì°¾ê¸° - ìˆ˜ì •ë¨: ì„± í¬ê¸° í‚¤ìš°ê¸° (ì„±ì€ ì´ëª¨ì§€ ìœ ì§€ ë˜ëŠ” ì´ë¯¸ì§€ë¡œ êµì²´ ê°€ëŠ¥, ì—¬ê¸°ì„  ì´ëª¨ì§€ë¡œ ë‘ )
                gameTargetEl.innerHTML = "<span>ğŸ°</span>";
                gameTargetEl.querySelector('span').style.fontSize = "9rem"; 
                dialogueBox.innerText = "ì´ì œ ë‹¤ ëª¨ì˜€ë‹¤! ì¢…ë¡œí•™ì›ìœ¼ë¡œ ê°€ì! (ê¾¹ ëˆ„ë¥´ì„¸ìš”)";
            }
            // íƒ€ê²Ÿ ìœ„ì¹˜ ë¦¬ì…‹ (í™”ë©´ ì˜¤ë¥¸ìª½ ë°–)
            gameTargetEl.style.right = "-150px"; 
            walkProgressEl.style.width = "0%";
            currentDistance = 0;
        }

        function gameLoop() {
            if (isPressing && memoryModal.style.display !== 'block') {
                currentDistance += SPEED;
                
                // ë°°ê²½ ìŠ¤í¬ë¡¤ íš¨ê³¼ (Parallax)
                bgStars.style.backgroundPositionX = `-${currentDistance * 0.5}px`;
                bgMountains.style.backgroundPositionX = `-${currentDistance * 2}px`;
                bgGround.style.backgroundPositionX = `-${currentDistance * 4}px`;

                // íƒ€ê²Ÿ ë‹¤ê°€ì˜¤ê¸°
                // 80% ì§€ì ë¶€í„° íƒ€ê²Ÿì´ í™”ë©´ ì•ˆìœ¼ë¡œ ë“¤ì–´ì˜´
                if (currentDistance > 80) {
                    const offset = (currentDistance - 80) * 5; // ë¹ ë¥´ê²Œ ì ‘ê·¼
                    gameTargetEl.style.right = `${10 + offset}px`;
                }

                // Progress Bar
                walkProgressEl.style.width = `${Math.min(currentDistance, 100)}%`;

                // ë„ë‹¬ ì²´í¬
                if (currentDistance >= TARGET_DISTANCE) {
                    isPressing = false;
                    playerPartyEl.classList.remove('walking');
                    triggerEncounter();
                    return; // Loop pauses until modal closed
                }
            }
            
            if (currentScene === 5) { // ê²Œì„ ì”¬ì¼ ë•Œë§Œ ë£¨í”„
                gameAnimationFrame = requestAnimationFrame(gameLoop);
            }
        }

        function triggerEncounter() {
            if (gameStage < 4) {
                // ì¹œêµ¬ ë§Œë‚¨ -> ì¶”ì–µ íŒì—…
                const memory = config.memories[gameStage];
                
                // ìˆ˜ì •: ê³ ì • ë¹„ìœ¨(aspect-square) ì œê±°í•˜ê³  ê°€ë³€ ë†’ì´ í—ˆìš©
                // ì‚¬ì§„ì˜ ë¹„ìœ¨ëŒ€ë¡œ ëœ¨ë„ë¡ ì„¤ì • (ê²€ì€ ì—¬ë°± ì œê±°)
                modalContent.className = `w-full flex items-center justify-center mb-4 border-2 border-white bg-black relative`;
                
                if (memory.imgUrl) {
                    // max-heightë¥¼ ì£¼ì–´ í™”ë©´ì„ ë„˜ì¹˜ì§€ ì•Šê²Œ í•˜ë˜, ë„ˆë¹„ëŠ” ê°€ë“ ì°¨ê±°ë‚˜ ë¹„ìœ¨ëŒ€ë¡œ ì¡°ì ˆ
                    modalContent.innerHTML = `<img src="${memory.imgUrl}" alt="Memory" class="max-w-full max-h-[60vh] object-contain">`;
                } else {
                    // ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ë°±ì—… (ê¸°ì¡´ ë°©ì‹)
                    // í…ìŠ¤íŠ¸/ì´ëª¨ì§€ì¼ ê²½ìš° ìµœì†Œ ë†’ì´ í™•ë³´
                    modalContent.classList.add('h-64'); 
                    modalContent.classList.add(memory.color);
                    modalContent.innerHTML = `<span class="text-5xl">${memory.emoji}</span>`;
                }

                modalText.innerText = memory.text;
                modalNextBtn.innerText = "ì¹œêµ¬ í•©ë¥˜ & ê³„ì† ê°€ê¸°";
                
                memoryModal.style.display = 'block';
                // ìˆ˜ì •: ë°œê²¬í•œ ì¹œêµ¬ë§ˆë‹¤ ë‹¤ë¥¸ ë©”ì‹œì§€ ì¶œë ¥ (fallback ì„¤ì •)
                dialogueBox.innerText = memory.encounterMsg || `ì¹œêµ¬ë¥¼ ë°œê²¬í–ˆë‹¤!`;

            } else {
                // ì„± ë„ì°© -> ì—”ë”©
                confettiEffect();
                setTimeout(() => {
                    currentScene++;
                    showScene(currentScene);
                }, 1000);
            }
        }

        function nextStage() {
            // ëª¨ë‹¬ ë‹«ê¸°
            memoryModal.style.display = 'none';
            
            // íŒŒí‹°ì› ì¶”ê°€
            const memory = config.memories[gameStage];
            const newFriend = document.createElement('div');
            newFriend.className = 'char-sprite';
            // ì´ë¯¸ì§€ íƒœê·¸ ì‚½ì…
            newFriend.innerHTML = `<img src="${memory.characterImg}" alt="Friend">`;
            
            // ì£¼ì¸ê³µ ë’¤(ì™¼ìª½)ì— ì¶”ê°€ (prepend ì‚¬ìš©)
            playerPartyEl.prepend(newFriend);
            
            // ìŠ¤í…Œì´ì§€ ì¦ê°€
            gameStage++;
            
            // ë‹¤ìŒ ëª©í‘œ ì„¤ì •
            updateTarget();
            
            // ê²Œì„ ë£¨í”„ ì¬ê°œ
            gameLoop();
        }


        // --- í­ì£½ íš¨ê³¼ ---
        function confettiEffect() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'];
            for(let i=0; i<50; i++) {
                const div = document.createElement('div');
                div.style.position = 'absolute';
                div.style.left = '50%';
                div.style.top = '50%';
                div.style.width = '10px';
                div.style.height = '10px';
                div.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                div.style.transition = 'all 1s ease-out';
                div.style.zIndex = '100';
                
                const angle = Math.random() * Math.PI * 2;
                const velocity = 200 + Math.random() * 200;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;

                gameScreen.appendChild(div);

                setTimeout(() => {
                    div.style.transform = `translate(${tx}px, ${ty}px) scale(0)`;
                    div.style.opacity = '0';
                }, 10);

                setTimeout(() => div.remove(), 1000);
            }
        }

        // --- ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        document.body.addEventListener('click', (e) => {
            if (isTyping) return;
            // ê²Œì„ ì”¬ì—ì„œëŠ” í´ë¦­ìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ì•ŠìŒ
            if (scenario[currentScene].type === 'game') return;
            if (e.target.tagName === 'BUTTON') return; 

            // ê°¤ëŸ¬ë¦¬ ì”¬ ì²˜ë¦¬ (New!)
            if (scenario[currentScene].type === 'gallery') {
                nextGalleryImage();
                return;
            }

            const currentType = scenario[currentScene].type;
            
            if (currentType === 'tap' || currentType === 'next') {
                
                // ì²« í´ë¦­(ê²Œì„ ì‹œì‘) ì‹œ BGM ì¬ìƒ ì‹œë„
                if (currentScene === 0) {
                    startBgm();
                }

                currentScene++;
                if (currentScene < scenario.length) {
                    showScene(currentScene);
                }
            }
        });

        // ì‹œì‘
        showScene(0);

    </script>
</body>
</html>